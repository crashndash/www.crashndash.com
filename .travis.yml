language: php
php:
  - 7.0

sudo: false

before_install:
  - echo 'sendmail_path = /bin/true' >> ~/.phpenv/versions/$(phpenv version-name)/etc/conf.d/travis.ini
  - phpenv config-rm xdebug.ini
  - composer --verbose self-update --$COMPOSER_CHANNEL
  - composer --version

install:
  - composer --verbose install

before_script:
  - npm i phantomjs-prebuilt
  - ./node_modules/.bin/phantomjs --webdriver=8643 &
  - ./vendor/bin/drush site-install minimal --verbose --yes --db-url=sqlite://tmp/site.sqlite
  - ./vendor/bin/drush runserver http://127.0.0.1:8888 &
  - ./vendor/bin/drush cset system.site uuid f24ccad9-2caf-47c5-97d5-5e111c8c4572 -y
  - composer import
  - ./vendor/bin/wait-for-listen 8888
  - ./vendor/bin/wait-for-listen 8643 127.0.0.1
script:
  - composer test
